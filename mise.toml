[tools]
pnpm = "10.24"

[env]
PROJECT = "weblog"

[tasks.astro]
description = "Start dev server"
run = "pnpm astro"

[tasks.dev]
description = "Start dev server"
run = "mise astro dev"

[tasks.build]
description = "Build application"
run = "mise astro build"

[tasks.preview]
description = "Preview application"
run = "mise astro preview"

[tasks.deps]
description = "Install dependencies"
run = "pnpm install"

[tasks.format]
description = "Format files"
run = "pnpm prettier --write ."

[tasks.scp]
description = "SCP"
run="""
scp -i $VPS_SSH_PUB_KEY
"""

[tasks.publish]
description = "Publish content"
run = """
mise scp -r ./src/content/posts deploy@$VPS_HOST:/var/lib/weblog/content/posts
mise scp -r ./src/content/recipes deploy@$VPS_HOST:/var/lib/weblog/content/recipes
"""

[tasks."prod:ssh"]
description = "SSH"
run="""
ssh -t -i $VPS_SSH_PUB_KEY deploy@$VPS_HOST
"""

[tasks."prod:shell"]
description = "SSH into the docker shell"
run="""
mise prod:ssh 'docker compose --project-directory "/opt/apps" exec -it weblog /bin/bash'
"""

[tasks."prod:logs"]
description = "Watch prod logs"
run="""
mise prod:ssh 'docker compose --project-directory "/opt/apps" logs -f weblog'
"""
